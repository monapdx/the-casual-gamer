<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>vCard QR Code Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f6f7fb;          /* app background */
      --panel: #ffffff;       /* card background */
      --text: #111827;        /* primary text */
      --muted: #6b7280;       /* secondary text */
      --border: #e5e7eb;      /* hairline borders */
      --input: #f3f4f6;       /* input background */
      --brand: #3b82f6;       /* primary blue */
      --brand-hover: #2563eb; /* darker blue */
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      color: var(--text);
      background: var(--bg);
    }

    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }

    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 16px; }
    .title { display: flex; align-items: center; gap: 12px; }
    .logo { width: 36px; height: 36px; display: grid; place-items: center; border-radius: 10px; background: var(--brand); color: #fff; font-weight: 800; }
    .title div:first-child + div { display: grid; gap: 2px; }
    .title div:first-child + div > div:first-child { font-size: 18px; font-weight: 800; text-transform: uppercase; letter-spacing: .08em; }
    .sub { color: var(--muted); font-size: 13px; }

    .grid { display: grid; grid-template-columns: 1.1fr .9fr; gap: 20px; }
    @media (max-width: 900px){ .grid { grid-template-columns: 1fr; } }

    /* Card matches screenshot: white, subtle border, soft shadow, rounded corners */
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    .card h2 { margin: 0 0 12px; font-size: 16px; font-weight: 800; text-transform: uppercase; letter-spacing: .08em; }

    .row { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; margin-bottom: 12px; }
    .field { grid-column: span 6; }
    .field.sm { grid-column: span 4; }
    .field.lg { grid-column: span 12; }

    .label { display: block; font-size: 12px; font-weight: 600; color: var(--muted); margin-bottom: 6px; }

    input, select, textarea {
      width: 100%;
      appearance: none;
      font-size: 14px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--input);
      color: var(--text);
      outline: none;
      transition: box-shadow .15s ease, border-color .15s ease, background-color .15s ease;
    }
    textarea { resize: vertical; min-height: 70px; }
    input::placeholder, textarea::placeholder { color: #9ca3af; }
    input:focus, select:focus, textarea:focus { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(59,130,246,.2); background: #fff; }

    .hint { color: var(--muted); font-size: 12px; margin-top: 4px; }

    .actions { display: flex; gap: 10px; flex-wrap: wrap; }

    /* Buttons: blue primary + subtle secondary and outline */
    button {
      appearance: none;
      border: 1px solid transparent;
      background: var(--brand);
      color: #fff;
      font-weight: 700;
      border-radius: 10px;
      padding: 10px 14px;
      cursor: pointer;
      transition: background-color .15s ease, border-color .15s ease, opacity .15s ease;
    }
    button:hover { background: var(--brand-hover); }
    button:disabled { opacity: .55; cursor: not-allowed; }

    button.secondary { background: #fff; color: var(--text); border-color: var(--border); }
    button.secondary:hover { border-color: #cbd5e1; }

    button.ghost { background: #fff; color: var(--text); border: 1px dashed var(--border); }

    .inline { display: flex; gap: 10px; align-items: center; }

    .qr-wrap {
      display: grid; place-items: center; padding: 14px; background: var(--input);
      border: 1px solid var(--border); border-radius: 12px; min-height: 320px;
    }
    .qr-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }

    .footer { text-align: center; color: var(--muted); font-size: 12px; margin-top: 14px; }
    .badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border: 1px solid var(--border); border-radius: 999px; background: #fff; color: var(--muted); }
  </style>
  <!-- QRCode.js (small, dependency-free) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-Mn0x3bQe6O9N9yQ0QqHGoD8l3uR9oM3nQ5Pp4t3mS0xjYvG7v7t8VY8gkJ0+X2Xy7X8f5y1+1C0WJqG7YkGm1w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div class="container">
    <header>
      <div class="title"><div class="logo">VC</div><div>
        <div style="font-size:18px">vCard QR Code Generator</div>
        <div class="sub">Create a downloadable .vcf and matching QR code your contacts can scan.</div>
      </div></div>
      <div class="badge" title="Everything runs locally in your browser.">⚡ Client‑side only</div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>Contact Details</h2>
        <form id="vcard-form">
          <div class="row">
            <div class="field sm"><label class="label">First Name*</label><input id="first" required placeholder="Ada" /></div>
            <div class="field sm"><label class="label">Last Name*</label><input id="last" required placeholder="Lovelace" /></div>
            <div class="field sm"><label class="label">Prefix</label><input id="prefix" placeholder="Dr." /></div>
            <div class="field sm"><label class="label">Suffix</label><input id="suffix" placeholder="PhD" /></div>
            <div class="field sm"><label class="label">Title</label><input id="title" placeholder="CTO" /></div>
            <div class="field sm"><label class="label">Organization</label><input id="org" placeholder="Analytical Engines, Inc." /></div>
          </div>

          <div class="row">
            <div class="field sm"><label class="label">Email</label><input id="email" type="email" placeholder="ada@example.com" /></div>
            <div class="field sm"><label class="label">Phone (Work)</label><input id="telWork" placeholder="+1 555 123 4567" /></div>
            <div class="field sm"><label class="label">Phone (Mobile)</label><input id="telCell" placeholder="+1 555 987 6543" /></div>
            <div class="field sm"><label class="label">Website</label><input id="url" type="url" placeholder="https://example.com" /></div>
          </div>

          <div class="row">
            <div class="field sm"><label class="label">Street</label><input id="street" placeholder="123 Example St" /></div>
            <div class="field sm"><label class="label">City</label><input id="city" placeholder="London" /></div>
            <div class="field sm"><label class="label">Region/State</label><input id="region" placeholder="Greater London" /></div>
            <div class="field sm"><label class="label">Postal Code</label><input id="zip" placeholder="EC1A 1BB" /></div>
            <div class="field sm"><label class="label">Country</label><input id="country" placeholder="UK" /></div>
            <div class="field sm"><label class="label">Note</label><input id="note" placeholder="Met at JSConf" /></div>
          </div>

          <div class="row">
            <div class="field sm">
              <label class="label">vCard Version</label>
              <select id="version">
                <option value="3.0" selected>3.0 (most compatible)</option>
                <option value="4.0">4.0</option>
              </select>
              <div class="hint">3.0 works on iOS/Android/most scanners. 4.0 adds modern fields.</div>
            </div>
            <div class="field sm">
              <label class="label">QR Size (px)</label>
              <input id="qrSize" type="number" min="128" max="1024" step="16" value="320" />
            </div>
            <div class="field sm">
              <label class="label">Error Correction</label>
              <select id="qrLevel">
                <option value="L">L (7%)</option>
                <option value="M" selected>M (15%)</option>
                <option value="Q">Q (25%)</option>
                <option value="H">H (30%)</option>
              </select>
            </div>
            <div class="field sm">
              <label class="label">Margin (modules)</label>
              <input id="qrMargin" type="number" min="0" max="8" value="2" />
            </div>
          </div>

          <div class="actions">
            <button type="submit">Generate</button>
            <button type="button" class="secondary" id="btn-clear">Clear</button>
            <button type="button" class="ghost" id="btn-example">Fill Example</button>
          </div>
        </form>
      </section>

      <section class="card">
        <h2>Preview</h2>
        <div class="qr-wrap">
          <div id="qrcode" aria-live="polite"></div>
        </div>
        <div class="qr-controls">
          <button id="btn-download-png" disabled>Download QR (PNG)</button>
          <button id="btn-download-vcf" disabled>Download Contact (.vcf)</button>
        </div>
        <div class="actions" style="margin-top:10px">
          <button id="btn-copy-vcard" class="secondary" disabled>Copy vCard Text</button>
          <button id="btn-copy-url" class="secondary" disabled>Copy vCard Data URL</button>
        </div>
      </section>
    </div>

    <div class="footer">Pro tip: Add your logo as a background behind the QR when printing business cards.</div>
  </div>

  <script>
    // Utility: escape commas/semicolons/newlines per vCard text values
    function esc(v){
      return String(v || "").replace(/\\/g, "\\\\").replace(/\n/g, "\\n").replace(/,/g, "\\,").replace(/;/g, "\\;");
    }

    function buildVCard(){
      const get = id => document.getElementById(id).value.trim();
      const version = get('version');
      const first = get('first');
      const last = get('last');
      if(!first || !last){
        alert('Please provide at least First and Last name.');
        return null;
      }
      const prefix = get('prefix');
      const suffix = get('suffix');
      const title = get('title');
      const org = get('org');
      const email = get('email');
      const telWork = get('telWork');
      const telCell = get('telCell');
      const url = get('url');
      const street = get('street');
      const city = get('city');
      const region = get('region');
      const zip = get('zip');
      const country = get('country');
      const note = get('note');

      const lines = [];
      lines.push('BEGIN:VCARD');
      lines.push('VERSION:' + version);

      // N: Family;Given;Additional;Prefix;Suffix
      lines.push('N:' + esc(last) + ';' + esc(first) + ';;' + esc(prefix) + ';' + esc(suffix));
      // FN: Formatted Name
      lines.push('FN:' + esc([prefix, first, last, suffix].filter(Boolean).join(' ')));
      if(title) lines.push('TITLE:' + esc(title));
      if(org) lines.push('ORG:' + esc(org));

      if(email) lines.push('EMAIL;TYPE=INTERNET:' + esc(email));
      if(telWork) lines.push('TEL;TYPE=WORK,VOICE:' + esc(telWork));
      if(telCell) lines.push('TEL;TYPE=CELL,VOICE:' + esc(telCell));
      if(url) lines.push('URL:' + esc(url));

      // ADR: PO Box;Extended;Street;City;Region;PostalCode;Country
      if(street || city || region || zip || country){
        lines.push('ADR;TYPE=WORK:;;' + esc(street) + ';' + esc(city) + ';' + esc(region) + ';' + esc(zip) + ';' + esc(country));
      }
      if(note) lines.push('NOTE:' + esc(note));

      if(version === '4.0'){
        // Optional UID and PRODID for v4
        const uid = 'uid-' + Math.random().toString(36).slice(2);
        lines.push('PRODID:-//Local vCard QR//EN');
        lines.push('UID:' + uid);
      }

      lines.push('END:VCARD');
      return lines.join('\r\n');
    }

    let qrInstance = null;
    function renderQR(text){
      const size = Math.min(Math.max(parseInt(document.getElementById('qrSize').value || '320', 10), 128), 1024);
      const level = document.getElementById('qrLevel').value;
      const margin = Math.min(Math.max(parseInt(document.getElementById('qrMargin').value || '2', 10), 0), 8);

      const el = document.getElementById('qrcode');
      el.innerHTML = '';
      qrInstance = new QRCode(el, { text, width: size, height: size, correctLevel: QRCode.CorrectLevel[level], margin });
    }

    function enableOutputs(enabled){
      ['btn-download-png','btn-download-vcf','btn-copy-vcard','btn-copy-url'].forEach(id => {
        const b = document.getElementById(id); if(b) b.disabled = !enabled;
      });
    }

    function toDataUrlFromQRCode(){
      const el = document.querySelector('#qrcode canvas, #qrcode img');
      if(!el) return null;
      if(el.tagName === 'IMG') return el.src || null; // some implementations render IMG
      try { return el.toDataURL('image/png'); } catch(e){ return null; }
    }

    function download(filename, blob){
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
      setTimeout(() => URL.revokeObjectURL(url), 1000);
    }

    // Form handlers
    document.getElementById('vcard-form').addEventListener('submit', e => {
      e.preventDefault();
      const vcard = buildVCard();
      if(!vcard) return;
      renderQR(vcard);
      enableOutputs(true);
      // stash for later
      document.getElementById('btn-download-vcf').dataset.vcard = vcard;
      // also keep a Data URL version
      const dataUrl = 'data:text/x-vcard;charset=utf-8,' + encodeURIComponent(vcard);
      document.getElementById('btn-copy-url').dataset.url = dataUrl;
    });

    document.getElementById('btn-clear').addEventListener('click', () => {
      document.getElementById('vcard-form').reset();
      document.getElementById('qrcode').innerHTML = '';
      enableOutputs(false);
    });

    document.getElementById('btn-example').addEventListener('click', () => {
      const set = (id, v) => document.getElementById(id).value = v;
      set('first','Ada'); set('last','Lovelace'); set('prefix',''); set('suffix','');
      set('title','Chief Algorithm Officer'); set('org','Analytical Engines, Inc.');
      set('email','ada@example.com'); set('telWork','+1 555 867 5309'); set('telCell','+1 555 000 1234');
      set('url','https://example.com');
      set('street','123 Example St'); set('city','London'); set('region','Greater London'); set('zip','EC1A 1BB'); set('country','UK');
      set('note','Met at JSConf. Ask about the engine!');
    });

    // Downloads & clipboard
    document.getElementById('btn-download-png').addEventListener('click', () => {
      const dataUrl = toDataUrlFromQRCode();
      if(!dataUrl){ alert('Generate a QR first.'); return; }
      fetch(dataUrl).then(r => r.blob()).then(blob => download('vcard-qr.png', blob));
    });

    document.getElementById('btn-download-vcf').addEventListener('click', () => {
      const vcard = document.getElementById('btn-download-vcf').dataset.vcard;
      if(!vcard){ alert('Generate your vCard first.'); return; }
      const blob = new Blob([vcard], { type: 'text/vcard;charset=utf-8' });
      download('contact.vcf', blob);
    });

    document.getElementById('btn-copy-vcard').addEventListener('click', async () => {
      const vcard = document.getElementById('btn-download-vcf').dataset.vcard;
      if(!vcard){ alert('Generate your vCard first.'); return; }
      try { await navigator.clipboard.writeText(vcard); alert('vCard copied to clipboard.'); }
      catch { alert('Copy failed. Your browser may block clipboard access.'); }
    });

    document.getElementById('btn-copy-url').addEventListener('click', async () => {
      const url = document.getElementById('btn-copy-url').dataset.url;
      if(!url){ alert('Generate your vCard first.'); return; }
      try { await navigator.clipboard.writeText(url); alert('Data URL copied to clipboard.'); }
      catch { alert('Copy failed.'); }
    });

    // Disable outputs until first generation
    enableOutputs(false);
  </script>
</body>
</html>
