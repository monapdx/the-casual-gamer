<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Goal Progress Tracker</title>
  <style>
    :root {
      --bg: #0f172a;           /* slate-900 */
      --panel: #111827;        /* gray-900 */
      --muted: #94a3b8;        /* slate-400 */
      --text: #e5e7eb;         /* gray-200 */
      --accent: #60a5fa;       /* blue-400 */
      --accent-2: #34d399;     /* emerald-400 */
      --danger: #f87171;       /* red-400 */
      --card: #0b1220;         /* deeper slate */
      --ring: rgba(96,165,250,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 80% -10%, rgba(96,165,250,.12), transparent 60%),
                  radial-gradient(1000px 700px at -10% 110%, rgba(52,211,153,.10), transparent 60%),
                  var(--bg);
      color: var(--text);
    }
    header {
      max-width: 1100px; margin: 32px auto 0; padding: 0 16px;
    }
    h1 { font-weight: 800; letter-spacing: .2px; margin: 0 0 4px; }
    .sub { color: var(--muted); margin: 0 0 24px; }

    .container { max-width: 1100px; margin: 0 auto; padding: 0 16px 60px; }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(148,163,184,.15);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(2,6,23,.35), inset 0 1px 0 rgba(255,255,255,.03);
      backdrop-filter: blur(6px);
    }

    form#addGoalForm {
      display: grid;
      grid-template-columns: 1.5fr 1fr 1fr 1fr auto;
      gap: 12px;
      align-items: end;
    }

    label { display: block; font-size: 13px; color: var(--muted); margin: 2px 0 6px; }

    input[type="url"], input[type="text"], input[type="number"] {
      width: 100%;
      background: var(--card);
      color: var(--text);
      border: 1px solid rgba(148,163,184,.2);
      border-radius: 12px;
      padding: 12px 12px;
      outline: none;
      transition: box-shadow .15s ease, border-color .15s ease, transform .05s ease;
    }
    input:focus { box-shadow: 0 0 0 4px var(--ring); border-color: var(--accent); }

    .btn {
      appearance: none; border: 0; cursor: pointer;
      background: linear-gradient(90deg, var(--accent), #4ade80);
      color: #051524;
      font-weight: 700; letter-spacing: .25px;
      padding: 12px 14px; border-radius: 12px;
      box-shadow: 0 6px 18px rgba(59,130,246,.25);
      transition: transform .08s ease, filter .2s ease;
      white-space: nowrap;
    }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }

    .btn-secondary { background: #1f2937; color: var(--text); box-shadow: none; border: 1px solid rgba(148,163,184,.2); }
    .btn-danger { background: var(--danger); color: #1b0b0b; box-shadow: 0 6px 18px rgba(248,113,113,.25); }

    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 16px; }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border: 1px solid rgba(148,163,184,.16);
      border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;
    }
    .card .media { position: relative; background: #0a0f1a; }
    .card img { width: 100%; height: 180px; object-fit: cover; display: block; }
    .badge {
      position: absolute; right: 8px; bottom: 8px; font-size: 12px; font-weight: 800;
      background: rgba(2,6,23,.7); color: var(--text); padding: 6px 8px; border-radius: 999px; border: 1px solid rgba(148,163,184,.25);
      backdrop-filter: blur(4px);
    }
    .card .body { padding: 14px; display: grid; gap: 10px; }
    .title-row { display: flex; align-items: start; justify-content: space-between; gap: 8px; }
    .title-row a { color: var(--text); text-decoration: none; font-weight: 800; line-height: 1.25; }
    .title-row a:hover { text-decoration: underline; }

    .numbers { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; font-size: 13px; color: var(--muted); }
    .numbers div { background: #0b1120; border: 1px solid rgba(148,163,184,.12); padding: 8px; border-radius: 10px; }
    .numbers strong { display: block; color: var(--text); font-size: 14px; margin-top: 2px; }

    .progress {
      height: 12px; border-radius: 999px; background: #0b1220; border: 1px solid rgba(148,163,184,.2);
      overflow: hidden; position: relative;
    }
    .bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); transition: width .5s ease; }

    .actions { display: grid; grid-template-columns: 1fr auto auto; gap: 8px; align-items: center; }
    .actions input[type="number"] { padding: 10px 12px; }

    .empty { text-align: center; color: var(--muted); padding: 24px; border: 1px dashed rgba(148,163,184,.25); border-radius: 12px; }

    @media (max-width: 1024px) {
      form#addGoalForm { grid-template-columns: 1.4fr 1fr 1fr 1fr; }
      .grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 720px) {
      form#addGoalForm { grid-template-columns: 1fr; }
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Goal Progress Tracker</h1>
    <p class="sub">Paste a product link, set the price and how much you've saved. I'll fetch the title & image and track your progress.</p>
  </header>

  <div class="container">
    <div class="panel" style="margin-bottom: 16px;">
      <form id="addGoalForm">
        <div>
          <label for="url">Product URL</label>
          <input id="url" type="url" placeholder="https://store.example.com/product" required />
        </div>
        <div>
          <label for="price">Price (USD)</label>
          <input id="price" type="number" inputmode="decimal" step="0.01" min="0" placeholder="999.99" required />
        </div>
        <div>
          <label for="saved">Saved So Far (USD)</label>
          <input id="saved" type="number" inputmode="decimal" step="0.01" min="0" placeholder="0.00" />
        </div>
        <div>
          <label for="title">(Optional) Title</label>
          <input id="title" type="text" placeholder="Auto-fills from link" />
        </div>
        <div style="display:flex; gap:8px; align-items:end;">
          <button type="button" class="btn btn-secondary" id="fetchMetaBtn" title="Fetch title & image from the link">Fetch</button>
          <button class="btn" type="submit">Add Goal</button>
        </div>
        <div style="grid-column: 1 / -1; display:none;" id="imageFieldWrap">
          <label for="imageUrl">(Optional) Image URL (auto-filled if found)</label>
          <input id="imageUrl" type="url" placeholder="https://...jpg" />
        </div>
      </form>
      <p id="hint" style="margin:10px 2px 0; color:var(--muted); font-size:13px;">
        Tip: If a site blocks previews, you can paste a title and/or image manually. Your goals are saved locally in your browser.
      </p>
    </div>

    <div id="goalsWrap" class="grid"></div>
    <div id="emptyState" class="empty" style="display:none;">No goals yet. Add your first one above ✨</div>
  </div>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const fmt = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
  const storeKey = 'goal_tracker_v1';

  const state = {
    goals: load()
  };

  function load(){
    try { return JSON.parse(localStorage.getItem(storeKey)) || []; }
    catch { return []; }
  }
  function save(){ localStorage.setItem(storeKey, JSON.stringify(state.goals)); }

  function uid(){ return Math.random().toString(36).slice(2) + Date.now().toString(36); }

  function percent(saved, price){
    if (!price || price <= 0) return 0;
    return Math.max(0, Math.min(100, (saved / price) * 100));
  }

  function render(){
    const wrap = $('#goalsWrap');
    wrap.innerHTML = '';
    if (!state.goals.length){
      $('#emptyState').style.display = 'block';
      return;
    }
    $('#emptyState').style.display = 'none';

    state.goals.forEach(g => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="media">
          <img src="${escapeHtml(g.image || placeholderImage(g.title))}" alt="${escapeHtml(g.title || 'Goal image')}" onerror="this.src='${placeholderImage(g.title)}'"/>
          <span class="badge">${Math.round(percent(g.saved, g.price))}%</span>
        </div>
        <div class="body">
          <div class="title-row">
            <a href="${escapeAttr(g.url)}" target="_blank" rel="noopener">${escapeHtml(g.title || new URL(g.url).hostname)}</a>
            <button class="btn btn-danger" data-del="${g.id}" title="Delete">Delete</button>
          </div>
          <div class="numbers">
            <div>Price<strong>${fmt.format(g.price || 0)}</strong></div>
            <div>Saved<strong>${fmt.format(g.saved || 0)}</strong></div>
            <div>Remaining<strong>${fmt.format(Math.max(0, (g.price||0) - (g.saved||0)))}</strong></div>
          </div>
          <div class="progress"><div class="bar" style="width:${percent(g.saved, g.price)}%"></div></div>
          <div class="actions">
            <input type="number" step="0.01" min="0" placeholder="Add or set saved…" value="" data-addsaved="${g.id}" />
            <button class="btn btn-secondary" data-add="${g.id}">Add to Saved</button>
            <button class="btn" data-set="${g.id}">Set Saved</button>
          </div>
        </div>
      `;
      wrap.appendChild(card);
    });

    // wire actions
    $$("[data-del]").forEach(b => b.onclick = () => {
      const id = b.getAttribute('data-del');
      state.goals = state.goals.filter(x => x.id !== id);
      save(); render();
    });

    $$("[data-add]").forEach(b => b.onclick = () => {
      const id = b.getAttribute('data-add');
      const input = document.querySelector(`[data-addsaved="${id}"]`);
      const val = toNum(input.value);
      if (val > 0){
        const g = state.goals.find(x => x.id === id);
        g.saved = round2((g.saved || 0) + val);
        input.value = '';
        save(); render();
      }
    });

    $$("[data-set]").forEach(b => b.onclick = () => {
      const id = b.getAttribute('data-set');
      const input = document.querySelector(`[data-addsaved="${id}"]`);
      const val = toNum(input.value);
      if (val >= 0){
        const g = state.goals.find(x => x.id === id);
        g.saved = round2(val);
        input.value = '';
        save(); render();
      }
    });
  }

  function toNum(v){ return Math.max(0, Number.parseFloat(v || '0')) || 0; }
  function round2(n){ return Math.round((n + Number.EPSILON) * 100) / 100; }

  function placeholderImage(text){
    const t = encodeURIComponent((text || 'Goal').slice(0, 16));
    // cute gradient placeholder using dummyimage
    return `https://dummyimage.com/800x500/0b1220/94a3b8&text=${t}`;
  }

  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c])); }
  function escapeAttr(s){ return escapeHtml(s).replace(/"/g, '&quot;'); }

  async function fetchMetadata(url){
    // Try Jina Reader as a CORS-friendly fetcher, then parse OG/Twitter tags
    const normalized = normalizeUrl(url);
    const readerUrl = `https://r.jina.ai/http://${normalized.replace(/^https?:\/\//,'')}`;
    try {
      const res = await fetch(readerUrl, { method: 'GET' });
      if (!res.ok) throw new Error('Reader failed');
      const html = await res.text();
      const title = matchFirst(html, /<meta\s+property=["']og:title["']\s+content=["']([^"']+)["'][^>]*>/i)
                 || matchFirst(html, /<meta\s+name=["']twitter:title["']\s+content=["']([^"']+)["'][^>]*>/i)
                 || matchFirst(html, /<title>([^<]+)<\/title>/i);
      const image = matchFirst(html, /<meta\s+property=["']og:image["']\s+content=["']([^"']+)["'][^>]*>/i)
                 || matchFirst(html, /<meta\s+name=["']twitter:image["']\s+content=["']([^"']+)["'][^>]*>/i);
      return { title, image };
    } catch (e){
      console.warn('Metadata fetch failed:', e);
      return { title: '', image: '' };
    }
  }

  function matchFirst(str, regex){
    const m = regex.exec(str);
    return m ? m[1].trim() : '';
  }

  function normalizeUrl(u){
    try { return new URL(u).href; } catch { return 'https://' + (u||'').replace(/^\/*/, ''); }
  }

  // Form handlers
  $('#fetchMetaBtn').addEventListener('click', async () => {
    const url = $('#url').value.trim();
    if (!url) return;
    toggleImageField(true);
    const { title, image } = await fetchMetadata(url);
    if (title) $('#title').value = title;
    if (image) $('#imageUrl').value = image;
  });

  function toggleImageField(show){ $('#imageFieldWrap').style.display = show ? 'block' : 'none'; }

  $('#addGoalForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const url = $('#url').value.trim();
    const price = toNum($('#price').value);
    const saved = toNum($('#saved').value);
    let title = $('#title').value.trim();
    let image = $('#imageUrl').value.trim();

    if (!title || !image){
      const meta = await fetchMetadata(url);
      title = title || meta.title || '';
      image = image || meta.image || '';
    }

    const goal = { id: uid(), url: normalizeUrl(url), title, image, price, saved };
    state.goals.unshift(goal);
    save();
    // reset form
    e.target.reset();
    toggleImageField(false);
    render();
  });

  // initial
  render();
})();
</script>
</body>
</html>
